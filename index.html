<!doctype html>
<html lang="it">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>TO BUY LIST EDO</title>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" />
        <link rel="stylesheet" href="styles.css" />
    </head>
    <body>
        <div id="authContainer" style="display: none">
            <h2>Login</h2>
            <input type="email" id="emailInput" placeholder="Email" />
            <input type="password" id="passwordInput" placeholder="Password" />
            <button onclick="loginUser()">Enter</button>
        </div>
        <div id="sidebarContainer"></div>

        <div id="welcomeMessage" style="display: none; text-align: center; font-size: 24px; font-weight: bold">
            Ciao!!
        </div>

        <div id="mainContainer" style="display: none">
            <button id="logoutButton">Logout</button>

            <!-- 🔥 Sidebar inclusa dinamicamente -->
            <script>
                fetch("sidebar.html")
                    .then((response) => response.text())
                    .then((data) => {
                        document.getElementById("sidebarContainer").innerHTML = data;

                        // 🔥 Carica sidebar.js solo dopo il caricamento della sidebar
                        const script = document.createElement("script");
                        script.type = "module";
                        script.src = "sidebar.js";
                        document.body.appendChild(script);

                        // 🔥 Associa il toggle della sidebar
                        document.getElementById("openSidebar")?.addEventListener("click", toggleSidebar);

                        // 🔥 Attendi il caricamento della sidebar prima di aggiornare l'email
                        setTimeout(() => {
                            const userEmailElement = document.querySelector("#userEmail");
                            if (userEmailElement && typeof aggiornaEmail === "function") {
                                aggiornaEmail();
                            } else {
                                console.error(
                                    "❌ Elemento 'userEmail' ancora non trovato o funzione aggiornaEmail non disponibile!"
                                );
                            }
                        }, 500);
                    })
                    .catch((error) => console.error("Errore nel caricamento della sidebar:", error));
            </script>

            <!-- 🔥 Widget anteprima della lista To-Do -->
            <div id="widgetContainer">
                <h3 class="widget-title">List Preview</h3>
                <ul id="taskPreview">
                    <li>Loading..</li>
                </ul>
                <div class="widget-button-container">
                    <button class="widget-button" onclick="navigateTo('todolist.html')">Check the list</button>
                </div>
            </div>

            <!-- 🔥 Widget anteprima delle ricette -->
            <div id="latestRecipesContainer">
                <h3 class="widget-title">Latest Recipes</h3>
                <div id="latestRecipesList"></div>
                <div class="widget-button-container">
                    <button class="widget-button" onclick="navigateTo('ricettelista.html')">See All Recipes</button>
                </div>
            </div>

            <!-- 🔥 Widget anteprima delle note -->
            <div id="notesPreviewContainer">
                <h3 class="widget-title">Note Recenti</h3>
                <div id="notesPreviewList"></div>
                <div class="widget-button-container">
                    <button class="widget-button" onclick="navigateTo('notes-home.html')">Vedi tutte le note</button>
                </div>
            </div>
        </div>

        <script type="module" defer src="script.js"></script>
    </body>
</html>
